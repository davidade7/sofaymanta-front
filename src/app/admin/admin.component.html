<div class="admin-container">
  <h1>üõ†Ô∏è Panel de Administraci√≥n</h1>

  <div *ngIf="isLoading" class="loading">
    <p>Cargando...</p>
  </div>

  <div *ngIf="!isLoading" class="admin-content">
    <div class="quick-actions">
      <h3>Acciones R√°pidas</h3>
      <div class="actions-grid">
        <button class="action-btn" (click)="toggleStatistics()">
          üìä Estad√≠sticas
        </button>
        <button class="action-btn" (click)="toggleStreamingPlatforms()">
          üéûÔ∏è Gestionar Plataformas
        </button>
        <button class="action-btn" (click)="toggleUsers()">
          üë• Gestionar Usuarios
        </button>
        <button class="action-btn" (click)="toggleRatings()">
          ‚≠ê Gestionar Evaluaciones
        </button>
        <button class="action-btn" disabled>
          üí∞ Gestionar Publicidad
          <small>Pr√≥ximamente</small>
        </button>
      </div>
    </div>

    <!-- Secci√≥n de Estad√≠sticas -->
    <div *ngIf="showStatistics" class="statistics-section">
      <h3>üìä Estad√≠sticas de la Plataforma</h3>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">üë•</div>
          <div class="stat-content">
            <h4>Usuarios Registrados</h4>
            <p class="stat-number" *ngIf="!loadingStats">
              {{ totalUsers | number }}
            </p>
            <p class="stat-loading" *ngIf="loadingStats">Cargando...</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">‚≠ê</div>
          <div class="stat-content">
            <h4>Evaluaciones Totales</h4>
            <p class="stat-number" *ngIf="!loadingStats">
              {{ totalRatings | number }}
            </p>
            <p class="stat-loading" *ngIf="loadingStats">Cargando...</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Secci√≥n de Gesti√≥n de Usuarios -->
    <div *ngIf="showUsers" class="users-section">
      <h3>üë• Gesti√≥n de Usuarios</h3>

      <div *ngIf="loadingUsers" class="loading">
        <p>Cargando usuarios...</p>
      </div>

      <div *ngIf="!loadingUsers" class="users-list">
        <div class="users-header">
          <h4>Usuarios Registrados ({{ users.length }})</h4>
        </div>

        <div *ngIf="users.length === 0" class="no-users">
          <p>No hay usuarios registrados.</p>
        </div>

        <div *ngFor="let user of users" class="user-item">
          <div class="user-info">
            <div class="user-avatar">üë§</div>
            <div class="user-details">
              <h5>{{ user.username || "Sin nombre de usuario" }}</h5>
              <p class="user-email">{{ user.email }}</p>
              <p class="user-date">
                <strong>Registrado:</strong>
                {{ user.created_at | date : "dd/MM/yyyy HH:mm" }}
              </p>
              <span class="user-role" [class.admin]="user.role === 'admin'">
                {{ user.role === "admin" ? "üëë Admin" : "üë§ Usuario" }}
              </span>
            </div>
          </div>
          <div class="user-actions" *ngIf="user.role !== 'admin'">
            <button
              (click)="deleteUser(user.id)"
              class="btn-delete-user"
              title="Eliminar usuario"
            >
              <lucide-icon [img]="Trash2"></lucide-icon>
              Eliminar
            </button>
          </div>
          <div class="user-actions" *ngIf="user.role === 'admin'">
            <span class="admin-protection">Protegido</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Secci√≥n de Gesti√≥n de Evaluaciones -->
    <div *ngIf="showRatings" class="ratings-section">
      <h3>‚≠ê Gesti√≥n de Evaluaciones</h3>
      <div *ngIf="loadingRatings" class="loading">
        <p>Cargando evaluaciones...</p>
      </div>
      <div *ngIf="!loadingRatings" class="ratings-list">
        <div class="ratings-header">
          <h4>Evaluaciones Totales ({{ ratings.length }})</h4>
        </div>
        <div *ngIf="ratings.length === 0" class="no-ratings">
          <p>No hay evaluaciones.</p>
        </div>
        <div *ngFor="let rating of ratings" class="rating-item">
          <div class="rating-info">
            <div class="rating-user">
              <span class="user-avatar">
                {{
                  rating.username
                    ? rating.username.charAt(0).toUpperCase()
                    : "?"
                }}
              </span>
              <span class="username">{{
                rating.username || "Usuario desconocido"
              }}</span>
            </div>
            <div class="rating-media">
              <img
                *ngIf="rating.media_poster"
                [src]="'https://image.tmdb.org/t/p/w92' + rating.media_poster"
                [alt]="rating.media_title"
                class="media-poster"
              />
              <span class="media-title">
                {{
                  rating.media_title ||
                    rating.media_type + " #" + rating.media_id
                }}
              </span>
            </div>
            <div class="rating-details">
              <span class="rating-score">‚≠ê {{ rating.rating }}</span>
              <span class="rating-date">{{
                rating.createdAt | date : "dd/MM/yyyy HH:mm"
              }}</span>
              <span *ngIf="rating.comment" class="rating-comment">
                "{{ rating.comment }}"
              </span>
            </div>
          </div>
          <div class="rating-actions">
            <button
              (click)="deleteRating(rating.id, rating.user_id)"
              class="btn-delete-rating"
              title="Eliminar evaluaci√≥n"
            >
              <lucide-icon [img]="Trash2"></lucide-icon>
              Eliminar
            </button>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="showStreamingPlatforms" class="streaming-platforms-section">
      <h3>Gestionar Plataformas de Streaming</h3>

      <button (click)="isCreating = !isCreating" class="add-platform-btn">
        <lucide-icon [img]="isCreating ? X : Plus"></lucide-icon>
        {{ isCreating ? "Cancelar" : "Agregar Plataforma" }}
      </button>

      <div *ngIf="isCreating" class="platform-form">
        <h4>
          <lucide-icon [img]="Plus"></lucide-icon>
          Agregar Plataforma
        </h4>
        <div class="form-group">
          <label>Code TMDB:</label>
          <input
            type="text"
            [(ngModel)]="newPlatform.code"
            placeholder="netflix, disney, etc."
          />
        </div>

        <div class="form-group">
          <label>Name:</label>
          <input
            type="text"
            [(ngModel)]="newPlatform.name"
            placeholder="Netflix, Disney+, etc."
          />
        </div>

        <div class="form-group">
          <label>Logo URL:</label>
          <input
            type="text"
            [(ngModel)]="newPlatform.logo_url"
            placeholder="https://..."
          />
        </div>

        <div class="form-group">
          <label>Website URL:</label>
          <input
            type="text"
            [(ngModel)]="newPlatform.website_url"
            placeholder="https://..."
          />
        </div>

        <div class="form-group">
          <label class="toggle-label">
            <input
              type="checkbox"
              [(ngModel)]="newPlatform.is_active"
              class="toggle-input"
            />
            <span class="toggle-slider"></span>
            Plataforma activa
          </label>
        </div>

        <div class="form-actions">
          <button (click)="createPlatform()" class="btn-primary">
            <lucide-icon [img]="Plus"></lucide-icon>
            Crear
          </button>
        </div>
      </div>

      <!-- Lista de plataformas existentes -->
      <div class="platforms-list">
        <h4>Plataformas Existentes</h4>
        <div
          *ngFor="let platform of streamingPlatforms"
          class="platform-item"
          [class.inactive]="!platform.is_active"
        >
          <div class="platform-info">
            <img
              [src]="platform.logo_url"
              [alt]="platform.name"
              class="platform-logo"
            />
            <div class="platform-details">
              <h5>
                {{ platform.name }}
                <span
                  class="status-badge"
                  [class.active]="platform.is_active"
                  [class.inactive]="!platform.is_active"
                >
                  {{ platform.is_active ? "Activa" : "Inactiva" }}
                </span>
              </h5>
              <p><strong>Code:</strong> {{ platform.code }}</p>
              <a [href]="platform.website_url" target="_blank">{{
                platform.website_url
              }}</a>
            </div>
          </div>
          <div class="platform-actions">
            <button
              (click)="togglePlatformStatus(platform)"
              class="btn-toggle"
              [class.active]="platform.is_active"
            >
              <lucide-icon [img]="Power"></lucide-icon>
              {{ platform.is_active ? "Desactivar" : "Activar" }}
            </button>
            <button (click)="openEditForm(platform)" class="btn-edit">
              <lucide-icon [img]="Pencil"></lucide-icon>
              Editar
            </button>
            <button (click)="deletePlatform(platform.id)" class="btn-delete">
              <lucide-icon [img]="Trash2"></lucide-icon>
              Eliminar
            </button>
          </div>
        </div>
      </div>

      <!-- Formulario de edici√≥n -->
      <div *ngIf="selectedPlatform" class="platform-form edit-form">
        <h4>
          <lucide-icon [img]="Pencil"></lucide-icon>
          Editar Plataforma
        </h4>
        <div class="form-group">
          <label>Code:</label>
          <input type="text" [(ngModel)]="selectedPlatform.code" />
        </div>

        <div class="form-group">
          <label>Name:</label>
          <input type="text" [(ngModel)]="selectedPlatform.name" />
        </div>

        <div class="form-group">
          <label>Logo URL:</label>
          <input type="text" [(ngModel)]="selectedPlatform.logo_url" />
        </div>

        <div class="form-group">
          <label>Website URL:</label>
          <input type="text" [(ngModel)]="selectedPlatform.website_url" />
        </div>

        <div class="form-group">
          <label class="toggle-label">
            <input
              type="checkbox"
              [(ngModel)]="selectedPlatform.is_active"
              class="toggle-input"
            />
            <span class="toggle-slider"></span>
            Plataforma activa
          </label>
        </div>

        <div class="form-actions">
          <button (click)="updatePlatform()" class="btn-primary">
            <lucide-icon [img]="Pencil"></lucide-icon>
            Actualizar
          </button>
          <button (click)="closeEditForm()" class="btn-secondary">
            <lucide-icon [img]="X"></lucide-icon>
            Cancelar
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
